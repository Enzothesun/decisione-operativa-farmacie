<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Decisione Operativa ‚Äì Farmacie Medigas</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f2f4f7; margin: 0; padding: 0; }
    header { background: #1e4e79; color: white; padding: 24px; text-align: center; font-size: 24px; font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    .container { max-width: 900px; margin: 30px auto; padding: 0 20px; }
    .section { background: white; padding: 22px; border-radius: 14px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.12); }
    .section h2 { margin-top: 0; color: #1e4e79; font-size: 20px; font-weight: 600; border-left: 6px solid #1e4e79; padding-left: 10px; }
    label { font-weight: 600; display: block; margin-top: 14px; font-size: 15px; }
    select, input { width: 100%; padding: 12px; margin-top: 6px; border-radius: 8px; border: 1px solid #b3b3b3; background: #fafafa; font-size: 15px; }
    button { width: 100%; padding: 15px; margin-top: 25px; background: #1e4e79; color: white; border: none; font-size: 18px; border-radius: 10px; cursor: pointer; font-weight: 600; box-shadow: 0 3px 6px rgba(0,0,0,0.2); }
    button:hover { background: #163d61; }
    .output { background: #ffffff; padding: 25px; margin-top: 15px; border-left: 6px solid #1e4e79; border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.12); font-size: 16px; line-height: 1.6; }
    .output-title { font-size: 20px; font-weight: 600; color: #1e4e79; margin-bottom: 12px; }
    .highlight-red { color: #c62828; font-weight: 600; }
    .highlight-green { color: #2e7d32; font-weight: 600; }
</style>
</head>
<body>

<header>üíä Decisione Operativa ‚Äì Farmacie Medigas</header>

<div class="container">
    <div class="section">
        <h2>Input</h2>

        <label>Area farmacia</label>
        <select id="area" onchange="popolaSottozone()">
            <option value="">‚Äî Seleziona ‚Äî</option>
            <option value="brescia">Brescia e provincia</option>
            <option value="torino">Comuni di Torino</option>
            <option value="emilia">Emilia Romagna</option>
            <option value="sardegna">Sud Sardegna</option>
            <option value="resto">Resto d‚ÄôItalia</option>
        </select>

        <label>Zona / territorio</label>
        <select id="zona">
            <option value="">‚Äî Seleziona l'area prima ‚Äî</option>
        </select>

        <label>Giorno richiesto dalla farmacia</label>
        <input type="date" id="dataRichiesta">

        <label>Data e ora inserimento su Infomed</label>
        <input type="datetime-local" id="dataInserimento">

        <button onclick="calcola()">Genera Decisione Operativa</button>
    </div>

    <div class="section">
        <h2>Risultato</h2>
        <div id="result" class="output">Compila i campi per generare la decisione operativa.</div>
    </div>
</div>

<script>
// ORARI APERTURA / CHIUSURA
function isUfficioAperto(dt) {
    const g = dt.getDay(), h = dt.getHours(), m = dt.getMinutes();
    if (g >= 1 && g <= 4)
        return (h > 8 && h < 17) || (h === 8 && m >= 0) || (h === 17 && m === 0);
    if (g === 5)
        return (h > 8 && h < 16) || (h === 8 && m >= 0) || (h === 16 && m === 0);
    return false;
}

// SOTTOZONE DISPONIBILI
const sottozoneByArea = {
    brescia: [
        "Franciacorta",
        "Lago d'Iseo",
        "Brescia citt√†",
        "Bassa Bresciana",
        "Valsabbia",
        "Vallecamonica",
        "Lago di Garda",
        "Valtrompia"
    ],
    emilia: [
        "Cesena",
        "Forl√¨",
        "Ravenna",
        "Faenza",
        "Lugo"
    ],
    torino: [
        "Comuni di Torino"
    ],
    sardegna: [
        "Sud Sardegna"
    ]
};

// POPOLA SECONDA SELECT
function popolaSottozone() {
    const area = document.getElementById("area").value;
    const zonaSel = document.getElementById("zona");
    zonaSel.innerHTML = "";

    if (!area || area === "resto") {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = area === "resto"
            ? "Per il Resto d'Italia non serve selezionare la zona"
            : "‚Äî Seleziona l'area prima ‚Äî";
        zonaSel.appendChild(opt);
        zonaSel.disabled = (area === "resto" || !area);
        return;
    }

    zonaSel.disabled = false;
    const first = document.createElement("option");
    first.value = "";
    first.textContent = "‚Äî Seleziona zona ‚Äî";
    zonaSel.appendChild(first);

    sottozoneByArea[area].forEach(z => {
        const opt = document.createElement("option");
        opt.value = z;
        opt.textContent = z;
        zonaSel.appendChild(opt);
    });
}

// COSTI
const costi = {
    brescia:"25 ‚Ç¨",
    emilia:"50 ‚Ç¨",
    torino:"50 ‚Ç¨",
    sardegna:"‚Äî (non disponibili)",
    resto:"0 ‚Ç¨"
};

// VERIFICA PIANO CONSEGNE PRECISO
function isInPiano(area, zona, giorno) {
    // giorno: "lunedi"..."venerdi"
    if (area === "brescia") {
        if (giorno === "lunedi" || giorno === "mercoledi" || giorno === "venerdi") {
            return ["Franciacorta","Lago d'Iseo","Brescia citt√†","Bassa Bresciana","Valsabbia"]
                .includes(zona);
        }
        if (giorno === "martedi" || giorno === "giovedi") {
            return ["Vallecamonica","Lago di Garda","Brescia citt√†","Valtrompia"]
                .includes(zona);
        }
        return false;
    }

    if (area === "emilia") {
        if (giorno === "lunedi" || giorno === "mercoledi" || giorno === "venerdi") {
            return ["Cesena","Ravenna","Faenza","Lugo"].includes(zona);
        }
        if (giorno === "martedi" || giorno === "giovedi") {
            return ["Forl√¨","Ravenna","Faenza","Lugo"].includes(zona);
        }
        return false;
    }

    if (area === "torino") {
        // comuni di Torino tutti i giorni lun‚Äìven
        return ["lunedi","martedi","mercoledi","giovedi","venerdi"].includes(giorno);
    }

    if (area === "sardegna") {
        // Sud Sardegna solo lun, gio, ven
        if (!["Sud Sardegna"].includes(zona)) return false;
        return ["lunedi","giovedi","venerdi"].includes(giorno);
    }

    return false;
}

// FUNZIONE PRINCIPALE
function calcola() {
    const area = document.getElementById("area").value;
    const zona = document.getElementById("zona").value;
    const dRich = document.getElementById("dataRichiesta").value;
    const dIns = document.getElementById("dataInserimento").value;
    const res = document.getElementById("result");

    if (!area || !dRich || !dIns || (area !== "resto" && !zona)) {
        res.innerHTML = "<span class='highlight-red'>‚ö†Ô∏è Compila tutti i campi (inclusa la zona se richiesta).</span>";
        return;
    }

    const dtRich = new Date(dRich);
    const dtIns = new Date(dIns);

    const giorni = ["domenica","lunedi","martedi","mercoledi","giovedi","venerdi","sabato"];
    const giornoRich = giorni[dtRich.getDay()];
    const apertura = isUfficioAperto(dtIns);

    // Resto d'Italia: logica separata
    if (area === "resto") {
        res.innerHTML = `
            <div class="output-title">üìç Area: Resto d‚ÄôItalia</div>
            ‚úî La farmacia pu√≤ fare richiesta telefonica<br>
            ‚úî Nessun obbligo di inserimento su Infomed<br>
            ‚úî Costi supplementari: 0 ‚Ç¨<br><br>
            <b>Procedura:</b><br>
            ‚Äì Accogliere la richiesta telefonicamente<br>
            ‚Äì Fine
        `;
        return;
    }

    const inPiano = isInPiano(area, zona, giornoRich);
    const costo = costi[area];

    let html = `
        <div class="output-title">üìç Area: ${area.toUpperCase()}</div>
        <b>Zona:</b> ${zona}<br>
        <b>Giorno richiesto:</b> ${giornoRich.toUpperCase()}<br>
        <b>Inserimento:</b> ${apertura ? "<span class='highlight-green'>Uffici APERTI</span>" : "<span class='highlight-red'>Uffici CHIUSI</span>"}<br>
        <b>Piano consegne:</b> ${inPiano ? "‚úî In piano" : "‚õî Fuori piano"}<br>
        <b>Supplemento:</b> ${costo}<br><br>
        <div class="output-title">üîπ Procedura Operativa</div>
    `;

    if (apertura) {
        html += `
            ‚Äì NON prendere in carico la richiesta<br>
            ‚Äì NON inserire nulla su Infomed<br>
            ‚Äì Invitare la farmacia a inserire su Infomed<br>
            ‚Äì Aprire <b>Generica Brescia ‚Äì per tutte le zone</b><br>
            ‚Äì Gestione passa ad Assago
        `;
    } else {
        html += `
            <u>Se richiesta per giorni successivi:</u><br>
            ‚Äì Invitare la farmacia a usare Infomed<br>
            ‚Äì Aprire <b>Generica Brescia</b><br><br>
            <u>Se URGENZA (sera/festivi):</u><br>
            ‚Äì L‚Äôoperatore pu√≤ prendere in carico<br>
            ‚Äì Comunicare eventuali costi<br>
            ‚Äì Contattare il trasportatore<br>
            ‚Äì Aprire <b>Generica Brescia</b>
        `;
    }

    res.innerHTML = html;
}
</script>

</body>
</html>
